import{getNotFound as ae}from"./@qwik-city-not-found-paths.js";import{isStaticPath as ne}from"./@qwik-city-static-paths.js";import{_ as se,a as ie,v as oe,q as ce}from"./assets/@qwik-city-plan-ee411f09.js";import{s as le,r as fe,m as ue}from"./assets/entry.ssr-7717898d.js";var J=class extends Error{constructor(e,t){super(t),this.status=e}};function de(e,t){let r="Server Error";return t!=null&&(typeof t.message=="string"?r=t.message:r=String(t)),"<html>"+K(e,r)+"</html>"}function K(e,t){typeof e!="number"&&(e=500),typeof t=="string"?t=pe(t):t="";const r=typeof t=="string"?"600px":"300px",a=e>=500?ge:me;return`
<head>
  <meta charset="utf-8">
  <meta http-equiv="Status" content="${e}">
  <title>${e} ${t}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { color: ${a}; background-color: #fafafa; padding: 30px; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Roboto, sans-serif; }
    p { max-width: ${r}; margin: 60px auto 30px auto; background: white; border-radius: 4px; box-shadow: 0px 0px 50px -20px ${a}; overflow: hidden; }
    strong { display: inline-block; padding: 15px; background: ${a}; color: white; }
    span { display: inline-block; padding: 15px; }
  </style>
</head>
<body><p><strong>${e}</strong> <span>${t}</span></p></body>
`}var he=/[&<>]/g,pe=e=>e.replace(he,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return""}}),me="#006ce9",ge="#713fc2",I={lax:"Lax",none:"None",strict:"Strict"},we={seconds:1,minutes:1*60,hours:1*60*60,days:1*60*60*24,weeks:1*60*60*24*7},ye=(e,t,r)=>{const a=[`${e}=${t}`];return typeof r.domain=="string"&&a.push(`Domain=${r.domain}`),typeof r.maxAge=="number"?a.push(`Max-Age=${r.maxAge}`):Array.isArray(r.maxAge)?a.push(`Max-Age=${r.maxAge[0]*we[r.maxAge[1]]}`):typeof r.expires=="number"||typeof r.expires=="string"?a.push(`Expires=${r.expires}`):r.expires instanceof Date&&a.push(`Expires=${r.expires.toUTCString()}`),r.httpOnly&&a.push("HttpOnly"),typeof r.path=="string"&&a.push(`Path=${r.path}`),r.sameSite&&I[r.sameSite]&&a.push(`SameSite=${I[r.sameSite]}`),r.secure&&a.push("Secure"),a.join("; ")},be=e=>{const t={};if(typeof e=="string"&&e!==""){const r=e.split(";");for(const a of r){const s=a.split("=");s.length>1&&(t[decodeURIComponent(s[0].trim())]=decodeURIComponent(s[1].trim()))}}return t},T=Symbol("request-cookies"),$=Symbol("response-cookies"),X,Se=class{constructor(e){this[X]={},this[T]=be(e)}get(e){const t=this[T][e];return t?{value:t,json(){return JSON.parse(t)},number(){return Number(t)}}:null}getAll(){return Object.keys(this[T]).reduce((e,t)=>(e[t]=this.get(t),e),{})}has(e){return!!this[T][e]}set(e,t,r={}){const a=typeof t=="string"?t:encodeURIComponent(JSON.stringify(t));this[$][e]=ye(e,a,r)}delete(e,t){this.set(e,"deleted",{...t,maxAge:0})}headers(){return Object.values(this[$])}};X=$;var xe=(e,t)=>{const r=t.headers();if(r.length>0){const a=new Headers(e);for(const s of r)a.append("Set-Cookie",s);return a}return e},v=class{},P=class extends v{},z=new WeakMap,Re="qaction",ke="qfunc";function _e(e){const{url:t,params:r,request:a,status:s,locale:o}=e,n={};a.headers.forEach((l,d)=>n[d]=l);const i=e.sharedMap.get(M),f=e.sharedMap.get(ee),u=e.sharedMap.get(He);return{url:new URL(t.pathname+t.search,t).href,requestHeaders:n,locale:o(),nonce:u,qwikcity:{params:{...r},loadedRoute:je(e),response:{status:s(),loaders:D(e),action:i,formData:f}}}}var Ae=(e,t,r,a)=>{const s=[],o=[],n=[],i=!!(t&&We(t[1]));return e&&Q(s,o,n,e,i,r),t&&(i&&(r==="POST"&&(n.unshift(Me),n.push(Te)),n.push(ve),n.push(Ce)),Q(s,o,n,t[1],i,r),i&&(s.length+N.length>0&&n.push(N(s,o)),n.push(a))),n},Q=(e,t,r,a,s,o)=>{for(const n of a){typeof n.onRequest=="function"?r.push(n.onRequest):Array.isArray(n.onRequest)&&r.push(...n.onRequest);let i;switch(o){case"GET":{i=n.onGet;break}case"POST":{i=n.onPost;break}case"PUT":{i=n.onPut;break}case"PATCH":{i=n.onPatch;break}case"DELETE":{i=n.onDelete;break}case"OPTIONS":{i=n.onOptions;break}case"HEAD":{i=n.onHead;break}}if(typeof i=="function"?r.push(i):Array.isArray(i)&&r.push(...i),s){const f=Object.values(n).filter(l=>q(l,"server_loader"));e.push(...f);const u=Object.values(n).filter(l=>q(l,"server_action"));t.push(...u)}}},q=(e,t)=>e&&typeof e=="function"&&e.__brand===t;function N(e,t){return async r=>{if(r.headersSent){r.exit();return}const{method:a}=r,s=D(r),o=r[W];if(a==="POST"){const n=r.query.get(Re);if(n){const i=globalThis._qwikActionsMap,f=t.find(u=>u.__id===n)??(i==null?void 0:i.get(n));if(f){r.sharedMap.set(M,n);const u=await r.parseBody();if(!u||typeof u!="object")throw new Error("Expected request data to be an object");const l=await U(r,f.__validators,u);if(!l.success)s[n]=r.fail(l.status??500,l.error);else{const d=await f.__qrl(l.data,r);f.__qrl,s[n]=d}}}}e.length>0&&await Promise.all(e.map(n=>{const i=n.__id;return s[i]=U(r,n.__validators,void 0).then(f=>f.success?n.__qrl(r):r.fail(f.status??500,f.error)).then(f=>(typeof f=="function"?s[i]=f():(n.__qrl,s[i]=f),f))}))}}async function U(e,t,r){let a={success:!0,data:r};if(t)for(const s of t)if(a=await s.validate(e,r),a.success)r=a.data;else return a;return a}async function Te(e){const t=e.query.get(ke);if(t&&e.request.headers.get("X-QRL")===t&&e.request.headers.get("Content-Type")==="application/qwik-json"){e.exit();const r=e[W],a=await e.parseBody();if(Array.isArray(a)){const[s,...o]=a;if(Pe(s)&&s.getHash()===t){const n=await s.apply(e,o);e.headers.set("Content-Type","application/qwik-json"),e.send(200,await r._serializeData(n,!0));return}}throw e.error(500,"Invalid request")}}function ve(e){const t=L(e),{basePathname:r,pathname:a,url:s}=e;if(!re(a)&&a!==r&&!a.endsWith(".html")){if(t){if(!a.endsWith("/"))throw e.redirect(302,a+"/"+s.search)}else if(a.endsWith("/"))throw e.redirect(302,a.slice(0,a.length-1)+s.search)}}var Pe=e=>typeof e=="function"&&typeof e.getSymbol=="function";function We(e){const t=e[e.length-1];return t&&typeof t.default=="function"}function G(e,t){return e.pathname.endsWith(x)?e.pathname.slice(0,-x.length+(t?1:0))+e.search:e.pathname}var H=new TextEncoder;function Me({url:e,request:t,error:r}){let a=t.headers.get("origin"),s=e.origin;if(a!==s)throw r(403,`Cross-site ${t.method} form submissions are forbidden`)}function De(e){return async t=>{if(t.headersSent||t.pathname.endsWith(x))return;t.request.headers.forEach((d,g)=>d);const a=t.headers;a.has("Content-Type")||a.set("Content-Type","text/html; charset=utf-8");const s=L(t),{readable:o,writable:n}=new TextEncoderStream,i=t.getWritableStream(),f=o.pipeTo(i,{preventClose:!0}),u=n.getWriter(),l=t.status();try{const d=te(t)==="static",g=await e({base:t.basePathname+"build/",stream:u,serverData:_e(t),containerAttributes:{["q:render"]:d?"static":""}}),m={loaders:D(t),action:t.sharedMap.get(M),status:l!==200?l:200,href:G(t.url,s)};(typeof g).html==="string"&&await u.write(g.html),t.sharedMap.set("qData",m)}finally{await u.ready,await u.close(),await f}await i.close()}}async function Ce(e){if(re(e.pathname)){try{await e.next()}catch(l){if(!(l instanceof P))throw l}if(e.headersSent||e.exited)return;const r=e.status(),a=e.headers.get("Location"),s=L(e);if(r>=301&&r<=308&&a){const l=Oe(a);if(l){e.headers.set("Location",l),e.getWritableStream().close();return}else e.status(200),e.headers.delete("Location")}e.request.headers.forEach((l,d)=>l),e.headers.set("Content-Type","application/json; charset=utf-8");const n={loaders:D(e),action:e.sharedMap.get(M),status:r!==200?r:200,href:G(e.url,s),redirect:a??void 0},i=e.getWritableStream().getWriter(),u=await e[W]._serializeData(n,!0);i.write(H.encode(u)),e.sharedMap.set("qData",n),i.close()}}function Oe(e){if(e.startsWith("/")){const t=x,r=new URL(e,"http://localhost");return(r.pathname.endsWith("/")?r.pathname.slice(0,-1):r.pathname)+(t.startsWith("/")?"":"/")+t+r.search}else return}function $e(e){const t=[];return e==="day"?e=60*60*24:e==="week"?e=60*60*24*7:e==="month"?e=60*60*24*30:e==="year"?e=60*60*24*365:e==="private"?e={private:!0,noCache:!0}:e==="immutable"?e={public:!0,immutable:!0,maxAge:60*60*24*365,staleWhileRevalidate:60*60*24*365}:e==="no-cache"&&(e={noCache:!0}),typeof e=="number"&&(e={maxAge:e,sMaxAge:e,staleWhileRevalidate:e}),e.immutable&&t.push("immutable"),e.maxAge&&t.push(`max-age=${e.maxAge}`),e.sMaxAge&&t.push(`s-maxage=${e.sMaxAge}`),e.noStore&&t.push("no-store"),e.noCache&&t.push("no-cache"),e.private&&t.push("private"),e.public&&t.push("public"),e.staleWhileRevalidate&&t.push(`stale-while-revalidate=${e.staleWhileRevalidate}`),t.join(", ")}var Y=Symbol("RequestEvLoaders"),V=Symbol("RequestEvMode"),E=Symbol("RequestEvRoute"),W=Symbol("RequestEvQwikSerializer"),Z=Symbol("RequestEvTrailingSlash"),M="@actionId",ee="@actionFormData",He="@nonce";function Le(e,t,r,a=!0,s="/",o,n){const{request:i,platform:f,env:u}=e,l=new Se(i.headers.get("cookie")),d=new Headers,g=new URL(i.url);let m=-1,h=null,y,k=e.locale,w=200;const C=async()=>{for(m++;m<r.length;){const c=r[m],p=c(S);p instanceof Promise&&await p,m++}},b=()=>{if(h!==null)throw new Error("Response already sent")},R=(c,p)=>{if(b(),typeof c=="number"){w=c;const A=S.getWritableStream().getWriter();A.write(typeof p=="string"?H.encode(p):p),A.close()}else if(w=c.status,c.headers.forEach((_,A)=>{d.append(A,_)}),c.body){const _=S.getWritableStream();c.body.pipeTo(_)}else{if(w>=300&&w<400)return new P;S.getWritableStream().getWriter().close()}return new v},O={},j=new Map,S={[Y]:O,[V]:e.mode,[Z]:a,[E]:t,[W]:o,cookie:l,headers:d,env:u,method:i.method,params:(t==null?void 0:t[0])??{},pathname:g.pathname,platform:f,query:g.searchParams,request:i,url:g,basePathname:s,sharedMap:j,get headersSent(){return h!==null},get exited(){return m>=F},next:C,exit:()=>(m=F,new v),cacheControl:c=>{b(),d.set("Cache-Control",$e(c))},resolveValue:async c=>{const p=c.__id;if(c.__brand==="server_loader"&&!(p in O))throw new Error("You can not get the returned data of a loader that has not been executed for this request.");return O[p]},status:c=>typeof c=="number"?(b(),w=c,c):w,locale:c=>(typeof c=="string"&&(k=c),k||""),error:(c,p)=>(w=c,d.delete("Cache-Control"),new J(c,p)),redirect:(c,p)=>(b(),w=c,d.set("Location",p),d.delete("Cache-Control"),c>301&&d.set("Cache-Control","no-store"),new P),defer:c=>typeof c=="function"?c:()=>c,fail:(c,p)=>(b(),w=c,d.delete("Cache-Control"),{failed:!0,...p}),text:(c,p)=>(d.set("Content-Type","text/plain; charset=utf-8"),R(c,p)),html:(c,p)=>(d.set("Content-Type","text/html; charset=utf-8"),R(c,p)),parseBody:async()=>y!==void 0?y:y=Ie(S.request,j,o),json:(c,p)=>(d.set("Content-Type","application/json; charset=utf-8"),R(c,JSON.stringify(p))),send:R,isDirty:()=>h!==null,getWritableStream:()=>(h===null&&(h=e.getWritableStream(w,d,l,n,S)),h)};return Object.freeze(S)}function D(e){return e[Y]}function L(e){return e[Z]}function je(e){return e[E]}function te(e){return e[V]}var F=999999999,Ie=async(e,t,r)=>{var a;const s=e.clone(),o=((a=e.headers.get("content-type"))==null?void 0:a.split(/[;,]/,1)[0].trim())??"";if(o==="application/x-www-form-urlencoded"||o==="multipart/form-data"){const n=await s.formData();return t.set(ee,n),ze(n)}else{if(o==="application/json")return await s.json();if(o==="application/qwik-json")return r._deserializeData(await s.text())}},ze=e=>{const t={};return e.forEach((r,a)=>{const s=a.split(".").filter(n=>n);let o=t;for(let n=0;n<s.length;n++){let i=s[n];n===s.length-1?i.endsWith("[]")?(i=i.slice(0,-2),o[i]=o[i]||[],o[i].push(r)):o[i]=r:o=o[i]={}}}),t};function Qe(e,t,r,a=!0,s="/",o){let n;const i=new Promise(u=>n=u),f=Le(e,t,r,a,s,o,n);return{response:i,requestEv:f,completion:qe(f,n)}}async function qe(e,t){try{await e.next()}catch(r){if(r instanceof P)await e.getWritableStream().close();else if(r instanceof J){if(console.error(r),!e.headersSent){const a=de(r.status,r);e.html(r.status,a)}}else if(!(r instanceof v)){if(te(e)!=="dev")try{e.headersSent||(e.headers.set("content-type","text/html; charset=utf-8"),e.cacheControl({noCache:!0}),e.status(500));const a=e.getWritableStream();if(!a.locked){const s=a.getWriter();await s.write(H.encode(K(500,"Internal Server Error"))),await s.close()}}catch{console.error("Unable to render error page")}return r}}finally{e.isDirty()||t(null)}}function Ne(e,t){if(e.endsWith(x)){const r=e.length-Ue+(t?1:0);e=e.slice(0,r),e===""&&(e="/")}return e}var re=e=>e.endsWith(x),x="/q-data.json",Ue=x.length,Fe=async(e,t,r,a)=>{if(Array.isArray(e))for(const s of e){const o=s[0].exec(a);if(o){const n=s[1],i=Je(s[2],o),f=s[4],u=new Array(n.length),l=[],d=Be(t,a);let g;return n.forEach((m,h)=>{B(m,l,y=>u[h]=y,r)}),B(d,l,m=>g=m==null?void 0:m.default,r),l.length>0&&await Promise.all(l),[i,u,g,f]}}return null},B=(e,t,r,a)=>{if(typeof e=="function"){const s=z.get(e);if(s)r(s);else{const o=e();typeof o.then=="function"?t.push(o.then(n=>{a!==!1&&z.set(e,n),r(n)})):o&&r(o)}}},Be=(e,t)=>{if(e){t=t.endsWith("/")?t:t+"/";const r=e.find(a=>a[0]===t||t.startsWith(a[0]+(t.endsWith("/")?"":"/")));if(r)return r[1]}},Je=(e,t)=>{const r={};if(e)for(let a=0;a<e.length;a++){const s=(t==null?void 0:t[a+1])??"",o=s.endsWith("/")?s.slice(0,-1):s;r[e[a]]=decodeURIComponent(o)}return r};async function Ke(e,t,r){const{render:a,qwikCityPlan:s}=t,{routes:o,serverPlugins:n,menus:i,cacheModules:f,trailingSlash:u,basePathname:l}=s,d=e.url.pathname,g=Ne(d,u),m=await Xe(n,o,i,f,g,e.request.method,a);return m?Qe(e,m[0],m[1],u,l,r):null}async function Xe(e,t,r,a,s,o,n){const i=await Fe(t,r,a,s),f=Ae(e,i,o,De(n));return f.length>0?[i,f]:null}function Ge(e){globalThis.TextEncoderStream=Ve;const t={_deserializeData:se,_serializeData:ie,_verifySerializable:oe};e.manifest&&le(e.manifest);async function r({request:a,env:s,waitUntil:o,next:n}){try{const i=new URL(a.url);if(ne(a.method,i))return n();const f=i.hostname!=="127.0.0.1"&&i.hostname!=="localhost"&&i.port===""&&a.method==="GET",u=new Request(i.href,a),l=f?await caches.open("custom:qwikcity"):null;if(l){const h=await l.match(u);if(h)return h}const g=await Ke({mode:"server",locale:void 0,url:i,request:a,env:{get(h){return s[h]}},getWritableStream:(h,y,k,w)=>{const{readable:C,writable:b}=new TransformStream,R=new Response(C,{status:h,headers:xe(y,k)});return w(R),b},platform:s},e,t);if(g){g.completion.then(y=>{y&&console.error(y)});const h=await g.response;if(h)return h.ok&&l&&h.headers.has("Cache-Control")&&o(l.put(u,h.clone())),h}const m=ae(i.pathname);return new Response(m,{status:404,headers:{"Content-Type":"text/html; charset=utf-8","X-Not-Found":i.pathname}})}catch(i){return console.error(i),new Response(String(i||"Error"),{status:500,headers:{"Content-Type":"text/plain; charset=utf-8","X-Error":"cloudflare-pages"}})}}return r}var Ye=Promise.resolve(),Ve=class{constructor(){this._writer=null,this.readable={pipeTo:t=>{this._writer=t.getWriter()}},this.writable={getWriter:()=>{if(!this._writer)throw new Error("No writable stream");const t=new TextEncoder;return{write:async r=>{r!=null&&await this._writer.write(t.encode(r))},close:()=>this._writer.close(),ready:Ye}}}}};const at=Ge({render:fe,qwikCityPlan:ce,manifest:ue});export{at as onRequest};
