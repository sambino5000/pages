var P=Object.defineProperty;var R=(e,s,t)=>s in e?P(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var u=(e,s,t)=>(R(e,typeof s!="symbol"?s+"":s,t),t);import{B,K as q,_ as x}from"./q-7cf2f096.js";var l=null;typeof WebSocket<"u"?l=WebSocket:typeof MozWebSocket<"u"?l=MozWebSocket:typeof global<"u"?l=global.WebSocket||global.MozWebSocket:typeof window<"u"?l=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(l=self.WebSocket||self.MozWebSocket);const p=l;class ${constructor(){u(this,"listeners",new Map)}on(s,t){return this.listeners.has(s)||this.listeners.set(s,[]),this.listeners.get(s).push(t)-1}once(s,t){const n=this.on(s,(...o)=>{this.off(s,n),t(...o)})}off(s,t){const n=this.listeners.get(s);!n||n.length<t+1||(n[t]=null)}allOff(s){this.listeners.delete(s)}fire(s,...t){const n=this.listeners.get(s);if(!(!n||!n.length))for(const o of n)o&&o(...t)}}var d;(function(e){e.OPEN="open",e.CLOSE="close",e.CONNECTED="connected",e.DISCONNECTED="disconnected",e.RECONNECTING="reconnecting",e.ERROR="error",e.MESSAGE="message"})(d||(d={}));const j=1e3,_=500,W=1e3*10,N=1e3,O=class extends ${constructor(t,n={}){super();u(this,"options");u(this,"endpoint");u(this,"requests",new Map);u(this,"subscriptions",new Map);u(this,"connected",!1);u(this,"connectedTimeout");u(this,"reconnectionTimeout");u(this,"incompleteMessage","");u(this,"ws");this.endpoint=t,this.options=Object.assign(O.DEFAULT_OPTIONS,n),this.connect(),this.verbose&&Object.values(d).forEach(o=>{this.on(o,i=>i?console.debug(`ElectrumWS - ${o.toUpperCase()}:`,i):console.debug(`ElectrumWS - ${o.toUpperCase()}`))})}get verbose(){return this.options.verbose}async batchRequest(...t){this.connected||await new Promise(r=>this.once(d.CONNECTED,()=>r(!0)));let n;do n=Math.ceil(Math.random()*1e5);while(this.requests.has(n));const o=t.map(r=>({jsonrpc:"2.0",method:r.method,params:r.params,id:n++})),i=o.map(r=>this.createRequestPromise(r.id,r.method));return o.forEach(r=>this.ws.send(S(r))),Promise.all(i)}async request(t,...n){let o;do o=Math.ceil(Math.random()*1e5);while(this.requests.has(o));const i={jsonrpc:"2.0",method:t,params:n,id:o};this.connected||await new Promise(c=>this.once(d.CONNECTED,()=>c(!0)));const r=this.createRequestPromise(o,t);return this.verbose&&console.debug("ElectrumWS SEND:",t,...n),this.ws.send(S(i)),r}createRequestPromise(t,n){return new Promise((o,i)=>{const r=setTimeout(()=>{this.requests.delete(t),i(new Error("Request timeout"))},W);this.requests.set(t,{resolve:o,reject:i,method:n,timeout:r})})}async subscribe(t,n,...o){const i=`${t}${typeof o[0]=="string"?`-${o[0]}`:""}`;this.subscriptions.set(i,n),this.connected&&n(...o,await this.request(`${t}.subscribe`,...o))}async unsubscribe(t,...n){const o=`${t}${typeof n[0]=="string"?`-${n[0]}`:""}`;if(this.subscriptions.delete(o))return this.request(`${t}.unsubscribe`,...n)}isConnected(){return this.connected}async close(t){this.options.reconnect=!1;for(const[n,o]of this.requests)clearTimeout(o.timeout),this.requests.delete(n),this.verbose&&console.debug("Rejecting pending request:",o.method),o.reject(new Error(t));if(clearTimeout(this.reconnectionTimeout),this.ws.readyState===p.CONNECTING||this.ws.readyState===p.OPEN){const n=new Promise(o=>this.once(d.CLOSE,()=>o(!0)));return this.ws.close(N,t),n}return!0}connect(){let t=this.endpoint;this.options.token&&(t=`${t}?token=${this.options.token}`),this.ws=new p(t),this.ws.binaryType="arraybuffer",this.ws.addEventListener("open",this.onOpen.bind(this)),this.ws.addEventListener("message",this.onMessage.bind(this)),this.ws.addEventListener("error",this.onError.bind(this)),this.ws.addEventListener("close",this.onClose.bind(this))}onOpen(){this.fire(d.OPEN),this.connectedTimeout=setTimeout(()=>{this.connected=!0,this.fire(d.CONNECTED);for(const[t,n]of this.subscriptions){const o=t.split("-"),i=o.shift();if(!i){this.verbose&&console.warn("Cannot resubscribe, no method in subscription key:",t);continue}this.subscribe(i,n,...o).catch(r=>{(this.ws.readyState===p.CONNECTING||this.ws.readyState===p.OPEN)&&this.ws.close(N,r.message)})}},_)}onMessage(t){const n=typeof t.data=="string"?t.data:A(t.data),o=new RegExp(`\r|
| `,"g"),i=n.split(o).filter(r=>r.length>0);for(const r of i){const c=this.parseLine(r);if(c){if(this.fire(d.MESSAGE,c),"id"in c&&this.requests.has(c.id)){const a=this.requests.get(c.id);clearTimeout(a.timeout),this.requests.delete(c.id),"result"in c?a.resolve(c.result):c.error?a.reject(new Error(typeof c.error=="string"?c.error:c.error.message)):a.reject(new Error("No result"))}if("method"in c&&c.method.endsWith("subscribe")){const a=c.method.replace(".subscribe",""),h=c.params||[],C=`${a}${typeof h[0]=="string"?`-${h[0]}`:""}`;this.subscriptions.has(C)&&this.subscriptions.get(C)(...h)}}}}parseLine(t){try{const n=JSON.parse(t);return this.incompleteMessage="",n}catch{}return this.incompleteMessage&&!t.includes(this.incompleteMessage)?this.parseLine(`${this.incompleteMessage}${t}`):(this.verbose&&console.debug("Failed to parse JSON, retrying together with next message"),this.incompleteMessage=t,!1)}onError(t){t.error&&(this.verbose&&console.error("ElectrumWS ERROR:",t.error),this.fire(d.ERROR,t.error))}onClose(t){this.fire(d.CLOSE,t),this.connected?this.fire(d.DISCONNECTED):clearTimeout(this.connectedTimeout),this.options.reconnect&&this.connected&&(this.fire(d.RECONNECTING),this.reconnectionTimeout=setTimeout(()=>this.connect(),j)),this.connected=!1}};let b=O;u(b,"DEFAULT_OPTIONS",{reconnect:!0,verbose:!1});function A(e){return Array.isArray(e)&&(e=Buffer.concat(e)),new TextDecoder("utf-8").decode(e)}function v(e){return new TextEncoder().encode(e)}function S(e){return v(JSON.stringify(e)+`
`)}const U=(e,s)=>s.some(t=>e instanceof t);let D,M;function V(){return D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function K(){return M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const k=new WeakMap,g=new WeakMap,L=new WeakMap,m=new WeakMap,T=new WeakMap;function F(e){const s=new Promise((t,n)=>{const o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",r)},i=()=>{t(f(e.result)),o()},r=()=>{n(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",r)});return s.then(t=>{t instanceof IDBCursor&&k.set(t,e)}).catch(()=>{}),T.set(s,e),s}function z(e){if(g.has(e))return;const s=new Promise((t,n)=>{const o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",r),e.removeEventListener("abort",r)},i=()=>{t(),o()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",r),e.addEventListener("abort",r)});g.set(e,s)}let y={get(e,s,t){if(e instanceof IDBTransaction){if(s==="done")return g.get(e);if(s==="objectStoreNames")return e.objectStoreNames||L.get(e);if(s==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return f(e[s])},set(e,s,t){return e[s]=t,!0},has(e,s){return e instanceof IDBTransaction&&(s==="done"||s==="store")?!0:s in e}};function G(e){y=e(y)}function J(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(s,...t){const n=e.call(w(this),s,...t);return L.set(n,s.sort?s.sort():[s]),f(n)}:K().includes(e)?function(...s){return e.apply(w(this),s),f(k.get(this))}:function(...s){return f(e.apply(w(this),s))}}function Q(e){return typeof e=="function"?J(e):(e instanceof IDBTransaction&&z(e),U(e,V())?new Proxy(e,y):e)}function f(e){if(e instanceof IDBRequest)return F(e);if(m.has(e))return m.get(e);const s=Q(e);return s!==e&&(m.set(e,s),T.set(s,e)),s}const w=e=>T.get(e);function X(e,s,{blocked:t,upgrade:n,blocking:o,terminated:i}={}){const r=indexedDB.open(e,s),c=f(r);return n&&r.addEventListener("upgradeneeded",a=>{n(f(r.result),a.oldVersion,a.newVersion,f(r.transaction),a)}),t&&r.addEventListener("blocked",a=>t(a.oldVersion,a.newVersion,a)),c.then(a=>{i&&a.addEventListener("close",()=>i()),o&&a.addEventListener("versionchange",h=>o(h.oldVersion,h.newVersion,h))}).catch(()=>{}),c}const Y=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],E=new Map;function I(e,s){if(!(e instanceof IDBDatabase&&!(s in e)&&typeof s=="string"))return;if(E.get(s))return E.get(s);const t=s.replace(/FromIndex$/,""),n=s!==t,o=H.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(o||Y.includes(t)))return;const i=async function(r,...c){const a=this.transaction(r,o?"readwrite":"readonly");let h=a.store;return n&&(h=h.index(c.shift())),(await Promise.all([h[t](...c),o&&a.done]))[0]};return E.set(s,i),i}G(e=>({...e,get:(s,t,n)=>I(s,t)||e.get(s,t,n),has:(s,t)=>!!I(s,t)||e.has(s,t)}));async function Z(e){const s=new b("wss://chipnet.imaginary.cash:50004"),t=await s.request("blockchain.address.listunspent",e);return s.close("closed"),t}const ee=B(q(()=>x(()=>import("./q-c755f78c.js"),["build/q-c755f78c.js","build/q-7cf2f096.js"]),"s_xYL1qOwPyDI")),te={title:"Welcome to Qwik",meta:[{name:"description",content:"Qwik site description"}]};async function se(e,s){await(await X("UTXO-STORE",1,{upgrade(n){n.createObjectStore("addr-utxo")}})).put("addr-utxo",e,s)}const ie=Object.freeze(Object.defineProperty({__proto__:null,default:ee,getTokenUtxos:Z,head:te,saveTokenUtxoStore:se},Symbol.toStringTag,{value:"Module"}));export{Z as g,ie as i,X as o,se as s};
